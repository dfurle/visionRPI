<html>
<head>
 <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
 <!-- <script type="text/javascript" src="jquery.js"></script> -->
</head>

<body>
  <div id="left" style="width: 15%; float: left; border: solid black 3px; overflow: scroll; height: 100%; padding: 2px">
    <div class="slidecontainer">
      <div class="label" id="rgb">RGB</div>
      minR<input type="range" min="0" max="255" value="50" class="slider" id="minR"><output id="minRo" width=40px>50</output><br>
      maxR<input type="range" min="0" max="255" value="255" class="slider" id="maxR"><output id="maxRo" width=40px>255</output><br>
      minG<input type="range" min="0" max="255" value="50" class="slider" id="minG"><output id="minGo" width=40px>50</output><br>
      maxG<input type="range" min="0" max="255" value="255" class="slider" id="maxG"><output id="maxGo" width=40px>255</output><br>
      minB<input type="range" min="0" max="255" value="50" class="slider" id="minB"><output id="minBo" width=40px>50</output><br>
      maxB<input type="range" min="0" max="255" value="255" class="slider" id="maxB"><output id="maxBo" width=40px>255</output>
    </div>
    <br>
    <div class="slidecontainer">
      <div class="label" id="switches">Switches</div>
      High-Res<input id="SWres" type="checkbox" style="float: right"><br>
      print<input id="SWprint" type="checkbox" style="float: right"><br>
      frame<input id="SWframe" type="checkbox" style="float: right"><br>
      draw<input id="SWdraw" type="checkbox" style="float: right"><br>
      PT<input id="pt" type="number" min="0" max="3" step="1" value="0" style="float: right">
    </div>
    <br>
    <div class="slidecontainer">
      <div class="label" id="TRvec">T&R Vec</div>
      Use These<input id="trvec-box" type="checkbox"><br>
      tvec<br><input id="tvec0" type="number" min="-20" max="20" step="0.5" value="0">
      <input id="tvec1" type="number" min="-20" max="20" step="0.5" value="0">
      <input id="tvec2" type="number" min="-20" max="20" step="0.5" value="0"><br>
      rvec<br><input id="rvec0" type="number" min="-3.14" max="3.14" step="0.01" value="0.1">
      <input id="rvec1" type="number" min="-3.14" max="3.14" step="0.01" value="0.1">
      <input id="rvec2" type="number" min="-3.14" max="3.14" step="0.01" value="0.1">
    </div>
  </div>
  <div id="right" style="float: right; border: solid black 3px; overflow: scroll; height: 100%;">
    <div id="images" style="float: left; border: solid red 2px;">
      <div><img id="video_stream1" src="video_stream1" style="float: left; width: 100%"></div>
      <br>
      <div><img id="video_stream2" src="video_stream2" style="float: left; width: 100%"></div>
    </div>
    <div id="rpos" style="float: left; border: solid red 2px;">
      <img id="video_stream3" src="video_stream3" style="height: 100%">
    </div>
  </div>
</body>

<script type="text/javascript">
  $(document).ready(function() {

    $("#right").outerWidth($("body").width() - $("#left").outerWidth(true) - 1);
    var maxWidth = $("#right").width()-10;
    
    setInterval(function(){
      $("#rpos").height($("#images").height());
      $("#rpos").width($("#video_stream3").width());
      let widthSum = $("#images").outerWidth()+$("#rpos").outerWidth();
      $("#images").outerWidth($("#images").outerWidth()/widthSum*maxWidth);
      $("#rpos").outerWidth($("#rpos").outerWidth()/widthSum*maxWidth);
    }, 1000);

    function attach(elementID, amount = 1, skip = 0){
      let element = $("#"+elementID);
      for(let i = 0; i < amount; i++){
        element.on("input", onInput);
        for(let z = 0; z < skip; z++)
          element = element.next();
      }
    }

    attach("minR",6,3);
    attach("tvec0",3,1);
    attach("rvec0",3,1);
    attach("trvec-box");
    attach("SWres",5,2);
    attach("pt");

    function onInput(e) {
      let rgb = [], dist = [], tvec = [], rvec = [], switches = [];
      let element = $("#minR");
      for(let i = 0; i < 6; i++){
        rgb.push(element.val());
        element = element.next();
        element.html(rgb[rgb.length-1]);
        element = element.next().next();
      }
      element = $("#tvec0");
      for(let i = 0; i < 3; i++){
        let v = element.val();
        if(v=="")
          tvec.push(0);
        else
          tvec.push(v);
        element = element.next();
      }
      element = $("#rvec0");
      for(let i = 0; i < 3; i++){
        let v = element.val();
        if(v=="")
          rvec.push(0);
        else
          rvec.push(v);
        element = element.next();
      }
      function getCheck(element){
        return element.prop("checked") ? "1" : "0";
      }
      switches.push(getCheck($("#trvec-box")));
      element = $("#SWres");
      for(let i = 0; i < 4; i++){
        switches.push(getCheck(element));
        element = element.next().next();
      }
      
      let pt = "0";
      if($("#pt").val() == "")
        pt = "0";
      else
        pt = $("#pt").val();


      let data = "";
      data += rgb.join(",") + "\n";     // 0
      data += tvec.join(",") + "\n";    // 1
      data += rvec.join(",") + "\n";    // 2
      data += pt + "\n";                // 3
      data += switches.join(",") + "\n";// 4
      console.log(data);

      // High-Res - "SWres"
      // print - "SWprint"
      // frame - "SWframe"
      // draw - "SWdraw"

      $.ajax({
        type: 'PUT',
        url: 'data',
        contentType: 'text/plain',
        data: data,
      }).fail(function (msg) {
        console.log('FAIL');
      })
    }

    $.ajax({
      type: 'GET',
      url: 'initialData',
    }).fail(function (msg) {
      console.log('FAIL');
    }).then(function (msg) {
      data = msg.split(',')
      console.log(data)

      let element = $("#minR");
      for(let i = 0; i < 6; i++){
        element.val(data[i]);
        element = element.next();
        element.html(data[i]);
        element = element.next().next();
      }
      element = $("#SWres");
      for(let i = 0; i < 4; i++){
        element.prop('checked', Boolean(parseInt(data[6+i])));
        element = element.next().next();
      }
      $("pt").val(data[6+5]);
    })
  })
</script>	
</html>
